metadata: 
  title: Einfacher Autograder

environment: 
  url: http://clean-vervet

workflow: 
  - name: Set Course Context
    id: course
    use: Course
    with:
      name: kurs1
  
  # Get the submissions for an assignment
  - name: Get Assignment Submissions
    id: submissions
    use: Assignment::Submission
    context: course
    with: 
      name: Beispielaufgabe

  # This is where the magic happens
  - name: Autograding
    id: grades
    use: Script
    context: 
      input: submissions
    with: 
      script: | 
        console.log("Eingerichte Lösungen")
        const submissions = context.input.submissions;
        const grades = submissions.map(s => ({
           id: s.id,
           userid: s.userid,
           status: s.status,
           gradingstatus: s.gradingstatus,
           rawtext: s.data[0].rawtext
        }))
        .map((sub) => {
            sub.grade = 0;
            if (sub.rawtext.match(/richtig/)) {
              sub.grade = 100;
            }
            return sub;
        });
        output("grades", grades);
        console.log(grades);

  # report the scores to the students
  - name: Rückmeldung
    use: Assignment::Feedback
    with: 
      name: Beispielaufgaben
    context:
      course: course
      submissions: submissions
      grandes: grades

  
    